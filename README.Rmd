---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->



# miae <a href="https://agnesdeng.github.io/miae/"><img src="man/figures/logo.png" align="right" height="138" alt="miae website" /></a>


<!-- badges: start -->
<!-- badges: end -->

**miae** is an R package for multiple imputation through autoencoders built with **Torch**. 

```{r,setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  tidy = TRUE,
  tidy.opts = list(width.cutoff = 60),
  dev = "svg",
  dpi = 100,
  fig.retina = 1,
  fig.width = 9,
  fig.height = 3.5,
  out.width = "100%"
)
```

## 1. Installation

You can install the current development version of miae from [GitHub](https://github.com/) with:
``` r
# install.packages("devtools")
#devtools::install_github("agnesdeng/miae")
```

``` {r}
#To load the newborn dataset from the R package mixgb
library(mixgb)
#To obtain visualization diagnostics plot
library(vismi)
#Multiple imputation through autoencoder
library(miae)
```

## 2. Multiple imputation with denoising autoencoder with dropout
```{r}
#load the newborn dataset from the R package mixgb
data("newborn")
str(newborn)
colSums(is.na(newborn))
```

```{r,eval=FALSE}
#use default setting
midae_imp <- midae(data = newborn, m = 5,
                       save.model = TRUE, path = file.path (tempdir ( ), "midaemodel.pt"))
```

```{r}
#use customized setting
params<-list(input.dropout = 0.1, hidden.dropout = 0.3,
             optimizer = "adamW", learning.rate = 0.0001, encoder.structure = c(128, 64, 32), decoder.structure = c(32, 64, 128),
             scaler = "robust",
             act = "elu",
             init.weight = "he.normal.elu.dropout")

midae_imp<- midae(data = newborn, m = 5, 
                       categorical.encoding = "onehot", device = "cpu", 
                       epochs = 10, batch.size = 32, 
                       subsample = 1, early.stopping.epochs = 1,
                       dae.params = params, pmm.type = NULL, 
                       save.model = FALSE, path = file.path (tempdir ( ) , "midaemodel.pt"))

```

```{r, eval= FALSE}
# obtain the fifth imputed dataset
midae_imp[[5]]
``` 


```{r}
vismi(data = newborn, imp_list = midae_imp, x="recumbent_length_cm", y="head_circumference_cm")
```

## 3. Multiple imputation with variational autoencoder

```{r,eval=FALSE}
#use default setting
mivae.default <- mivae(data = newborn, m = 5,
                       save.model = TRUE, path = file.path (tempdir ( ), "mivaemodel.pt"))
```

```{r}
#use customized setting
params<-list(beta = 0.95, 
             optimizer = "adamW", learning.rate = 0.0001, encoder.structure = c(128, 64, 32), decoder.structure = c(32, 64, 128),
             scaler = "robust",
             act = "elu",
             init.weight = "he.normal.elu")

mivae_imp<- mivae(data = newborn, m = 5, 
                   categorical.encoding = "onehot", device = "cpu", 
                   epochs = 10, batch.size = 32, 
                   subsample =1, 
                   vae.params = params, pmm.type = NULL, 
                   save.model = FALSE, path = file.path (tempdir ( ), "mivaemodel.pt"))

```


```{r}
vismi(data = newborn, imp_list = mivae_imp, x="recumbent_length_cm", y="head_circumference_cm")
```


## 4. Impute new data using a saved imputation model
```{r}
set.seed(2026)
n <- nrow(newborn)
idx <- sample(1:n, size = round(0.7 * n), replace = FALSE)
train_data <- newborn[idx, ]
test_data <- newborn[-idx, ]
```


```{r}
mivae_obj<- mivae(data = train_data, m = 5, 
                   categorical.encoding = "onehot", device = "cpu", 
                   epochs = 10, batch.size = 32, 
                   vae.params = params, pmm.type = NULL, 
                   save.model = TRUE, path = file.path (tempdir ( ), "mivaemodel.pt"))
```

```{r}
mivae_imp_new <- impute_new(object = mivae_obj, newdata = test_data, m = 5)
```
